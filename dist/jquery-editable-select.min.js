!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],i):t.EditableSelect=i(t.$)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var i=function(i,s){this.options=s,this.$select=t(i),this.$input=t('<input type="text" autocomplete="off">'),this.$list=t('<ul class="es-list">'),this.utility=new e(this),["focus","manual"].indexOf(this.options.trigger)<0&&(this.options.trigger="focus"),["default","fade","slide"].indexOf(this.options.effects)<0&&(this.options.effects="default"),isNaN(this.options.duration)&&["fast","slow"].indexOf(this.options.duration)<0&&(this.options.duration="fast"),this.$select.replaceWith(this.$input),this.$list.appendTo(this.options.appendTo||this.$input.parent()),this.utility.initialize(),this.utility.initializeList(),this.utility.initializeInput(),this.utility.trigger("created")};i.DEFAULTS={filter:!0,effects:"default",duration:"fast",trigger:"focus"},i.prototype.filter=function(){var i=0,e=this.$input.val().toLowerCase().trim();this.$list.find("li").addClass("es-visible").show(),this.options.filter&&(i=this.$list.find("li").filter(function(i,s){return t(s).text().toLowerCase().indexOf(e)<0}).hide().removeClass("es-visible").length,this.$list.find("li").length==i&&this.hide())},i.prototype.show=function(){if(this.$list.css({top:this.$input.position().top+this.$input.outerHeight()-1,left:this.$input.position().left,width:this.$input.outerWidth()}),!this.$list.is(":visible")&&this.$list.find("li.es-visible").length>0){var i={default:"show",fade:"fadeIn",slide:"slideDown"}[this.options.effects];this.utility.trigger("show"),this.$input.addClass("open"),this.$list[i](this.options.duration,t.proxy(this.utility.trigger,this.utility,"shown"))}},i.prototype.hide=function(){var i={default:"hide",fade:"fadeOut",slide:"slideUp"}[this.options.effects];this.utility.trigger("hide"),this.$input.removeClass("open"),this.$list[i](this.options.duration,t.proxy(this.utility.trigger,this.utility,"hidden"))},i.prototype.select=function(t){this.$list.has(t)&&t.is("li.es-visible:not([disabled])")&&(this.$input.val(t.text()),this.options.filter&&this.hide(),this.filter(),this.utility.trigger("select",t))},i.prototype.add=function(i,e,s,l){var o=t("<li>").html(i),n=t("<option>").text(i),r=this.$list.find("li").length;0==(e=isNaN(e)?r:Math.min(Math.max(0,e),r))?(this.$list.prepend(o),this.$select.prepend(n)):(this.$list.find("li").eq(e-1).after(o),this.$select.find("option").eq(e-1).after(n)),this.utility.setAttributes(o,s,l),this.utility.setAttributes(n,s,l),this.filter()},i.prototype.remove=function(t){var i=this.$list.find("li").length;t=isNaN(t)?i:Math.min(Math.max(0,t),i-1),this.$list.find("li").eq(t).remove(),this.$select.find("option").eq(t).remove(),this.filter()},i.prototype.clear=function(){this.$list.find("li").remove(),this.$select.find("option").remove(),this.filter()},i.prototype.destroy=function(){this.$list.off("mousemove mousedown mouseup"),this.$input.off("focus blur input keydown"),this.$input.replaceWith(this.$select),this.$list.remove(),this.$select.removeData("editable-select")};var e=function(t){this.es=t};e.prototype.initialize=function(){var i=this;i.setAttributes(i.es.$input,i.es.$select[0].attributes,i.es.$select.data()),i.es.$input.addClass("es-input").data("editable-select",i.es),i.es.$select.find("option").each(function(e,s){var l=t(s).remove();i.es.add(l.text(),e,s.attributes,l.data()),l.attr("selected")&&i.es.$input.val(l.text())}),i.es.filter()},e.prototype.initializeList=function(){var i=this;i.es.$list.on("mousemove","li:not([disabled])",function(){i.es.$list.find(".selected").removeClass("selected"),t(this).addClass("selected")}).on("mousedown","li",function(e){t(this).is("[disabled]")?e.preventDefault():i.es.select(t(this))}).on("mouseup",function(){i.es.$list.find("li.selected").removeClass("selected")})},e.prototype.initializeInput=function(){var i=this;switch(this.es.options.trigger){default:case"focus":i.es.$input.on("focus",t.proxy(i.es.show,i.es)).on("blur",t.proxy(i.es.hide,i.es));break;case"manual":}i.es.$input.on("input keydown",function(t){switch(t.keyCode){case 38:s=(e=i.es.$list.find("li.es-visible:not([disabled])")).index(e.filter("li.selected"));i.highlight(s-1),t.preventDefault();break;case 40:var e=i.es.$list.find("li.es-visible:not([disabled])"),s=e.index(e.filter("li.selected"));i.highlight(s+1),t.preventDefault();break;case 13:i.es.$list.is(":visible")&&(i.es.select(i.es.$list.find("li.selected")),t.preventDefault());break;case 9:case 27:i.es.hide();break;default:i.es.filter(),i.highlight(0)}})},e.prototype.highlight=function(t){var i=this;i.es.show(),setTimeout(function(){var e=i.es.$list.find("li.es-visible"),s=i.es.$list.find("li.selected").removeClass("selected"),l=e.index(s);if(e.length>0){var o=(e.length+t)%e.length,n=e.eq(o),r=n.position().top;n.addClass("selected"),o<l&&r<0&&i.es.$list.scrollTop(i.es.$list.scrollTop()+r),o>l&&r+n.outerHeight()>i.es.$list.outerHeight()&&i.es.$list.scrollTop(i.es.$list.scrollTop()+n.outerHeight()+2*(r-i.es.$list.outerHeight()))}})},e.prototype.setAttributes=function(i,e,s){t.each(e||{},function(t,e){i.attr(e.name,e.value)}),i.data(s)},e.prototype.trigger=function(t){var i=Array.prototype.slice.call(arguments,1),e=[t+".editable-select"];e.push(i),this.es.$select.trigger.apply(this.es.$select,e),this.es.$input.trigger.apply(this.es.$input,e)};var s=function(e){var s=Array.prototype.slice.call(arguments,1);return this.each(function(){var l=t(this),o=l.data("editable-select"),n=t.extend({},i.DEFAULTS,l.data(),"object"==typeof e&&e);o||(o=new i(this,n)),"string"==typeof e&&o[e].apply(o,s)})};return t.fn.editableSelect=s,t.fn.editableSelect.Constructor=i,s});
